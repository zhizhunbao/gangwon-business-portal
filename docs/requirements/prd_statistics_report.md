---
name: prd_statistics_report
description: 统计报告功能需求文档。为管理员提供多维度的企业数据筛选与统计功能。
---

# PRD-006: 统计报告 (Statistics Report)

## 0. 版本信息

| 版本 | 日期       | 作者        | 说明                                                                      |
| :--- | :--------- | :---------- | :------------------------------------------------------------------------ |
| v1.0 | 2026-01-25 | Antigravity | 初始版本，基于 dev-prd 规范及客户 PPT 需求                                |
| v1.1 | 2026-01-25 | Antigravity | 同步 dev-terminology 命名规范，细化主导产业 KSIC 映射，明确 PII 脱敏规则  |
| v1.2 | 2026-01-26 | Antigravity | 增加代表者属性、创业阶段、工龄筛选，同步最新 API 路径与字段命名约定       |
| v1.3 | 2026-01-26 | Antigravity | 根据 PPT 需求(Page 2-4)重构筛选分类，明确“XX以上”量化逻辑及单卡片 UI 规范 |

## 1. 执行摘要与目标

### 1.1 功能概述

统计报告模块旨在为管理员提供一个强大的数据查询与分析工具。通过整合企业基础信息、发展阶段、财务状况（营收/出口）以及科研成果（专利），帮助决策者实时掌握江原道企业生态系统的动态。

### 1.2 核心业务痛点

- 管理员难以快速从海量企业中筛选出特定行业或特定发展阶段的领军企业。
- 缺乏对区域主导产业（如天然生物、数字医疗）的专项统计手段。
- 线下统计数据更新滞后，需要线上实时导出的 Excel 报告。

### 1.3 成功指标

- **查询效率**：在万级数据量下，筛选响应时间 < 2s。
- **数据导出**：支持全量及筛选后的数据 100% 准确导出至 Excel。

## 2. 用户故事 (User Stories)

| ID     | 角色           | 想要 (动作)                                    | 以便 (收益)                                |
| ------ | -------------- | ---------------------------------------------- | ------------------------------------------ |
| US-001 | 管理员 (Admin) | 使用年度/季度/月份组合筛选                     | 查看不同时间段的企业活跃情况。             |
| US-002 | 管理员 (Admin) | 按主导产业 KSIC 代码及区域映射筛选             | 统计重点扶持行业（如数字健康）的专项数据。 |
| US-003 | 管理员 (Admin) | 按政策关联（创业中心大学、全球事业、RISE）筛选 | 统计各扶持计划参与企业的分布和成果。       |
| US-004 | 管理员 (Admin) | 按投资引进情况（金额、轮次）筛选               | 识别获得高额投资的优质企业。               |
| US-005 | 管理员 (Admin) | 按知识产权（专利、商标）持有情况筛选           | 发现具有高技术含量和创新能力的企业。       |
| US-006 | 管理员 (Admin) | 按代表者特征（性别、年龄）筛选                 | 分析创业群体的画像特征。                   |
| US-007 | 管理员 (Admin) | 将筛选后的数据导出为脱敏后的 Excel 报告        | 进行线下的深入分析或生成年度汇报文档。     |

## 3. 功能需求 (Functional Requirements)

### 3.1 复合检索系统 (Filter System)

基于最新业务图示 (Page 002/003)，检索系统采用“单卡片+逻辑分组”布局，分为以下五大维度：

- **维度 1: 基本与行政 (General & Admin)**
  - 关键词搜索 (企业名/事业者号)
  - 时间维度 (年度/季度/月份) - **默认查询年份为 2025**
  - 所在地 (Chuncheon, Wonju, Gangneung 等)
- **维度 2: 产业与技术 (Industry & Tech)**
  - 标准产业分类 (KSIC) 大类/中类
  - **江原道主导产业** (Page 003 必选映射):
    - **天然物生物材料**: 10501, 10795, 10797, 11209, 21101, 21102...
    - **陶瓷原料·材料**: 20129, 20412, 23129, 23222, 23311...
    - **数字医疗保健**: 21300, 27111, 27112, 58221, 58222...
  - 地域主力产业代码 (Business Field)
  - 专利持有数量 (基于持有总数)
- **维度 3: 企业属性与阶段 (Identity & Lifecycle)**
  - 创业阶段 (预备/初期/成长/跳跃/再创业)
  - 业历工龄 (3年以下/3-7年/7年以上)
  - 创业身份类型 (学生创业/女性企业/风险企业等)
- **维度 4: 经营成果指标 (Performance)**
  - 投资引进情况 (是否引进 + 引进金额范围)
  - **年营收区间** (Annual Revenue Range)
  - **员工人数区间** (Employee Count Range)
- **维度 5: 代表者与外部参与 (Rep & Engagement)**
  - 代表者信息 (性别、年龄范围)
  * **参与政策项目** (创业中心大学、全球事业、RISE 事业团)
  * 产业合作意向领域

### 3.2 数据展示列表 (Statistics Table)

列表应包含以下关键字段映射：

| 字段名 (Frontend) | 字段名 (Backend) | 描述                      | 数据来源     |
| ----------------- | ---------------- | ------------------------- | ------------ |
| businessRegNo     | business_reg_no  | 事业者注册号              | 企业基础信息 |
| enterpriseName    | enterprise_name  | 企业名称                  | 企业基础信息 |
| industryType      | industry_type    | 所属业种 (KSIC)           | 企业基础信息 |
| startupStage      | startup_stage    | 创业阶段 (初期/成长/跳跃) | 企业基础信息 |
| policyTags        | policy_tags      | 参与项目标签              | 扶持事业信息 |
| totalInvestment   | total_investment | 投资引进总额 (韩元)       | 投资信息     |
| patentCount       | patent_count     | 专利持有数量              | 知识产权信息 |
| annualRevenue     | annual_revenue   | 最近一年营收 (韩元)       | 财务信息     |
| exportAmount      | export_amount    | 出口额                    | 财务信息     |

**界面展示参考**：参见 `通计리포트_PPT_4페이지.pptx` 第4页的表格样式。

### 3.3 筛选条件详细说明

#### 3.3.1 政策关联筛选实现

**数据来源路径**：

```
企业信息 (Company Info)
  └─ 事业信息 (Business Info)
      └─ 参与项目信息 (Participating Programs)
          ├─ 创业中心大学 (Startup-Centered University)
          ├─ 全球事业 (Global/Glocal Project)
          └─ RISE 事业团 (RISE Business Group)
```

**筛选逻辑**：

- 用户可以勾选一个或多个项目类型。
- 查询结果返回参与过**任意一个**被选中项目的企业（OR 逻辑）。
- 如果企业同时参与多个项目，在结果列表的"参与项目"列显示所有项目名称（逗号分隔）。

#### 3.3.2 投资筛选实现

**筛选维度**：

1. **投资引进与否**（是/否/全部）
2. **投资引进额范围**

**预设金额区间**：

- 1000万元以上
- 5000万元以上
- 1亿元以上
- 自定义区间（输入最小值和最大值）

**数据来源**：企业的投资信息表，统计所有投资记录的总额。

#### 3.3.3 知识产权筛选实现

**筛选维度**：专利持有数量

**预设数量区间**：

- 1个以上
- 3个以上
- 5个以上
- 10个以上
- 自定义区间（输入最小值和最大值）

**数据来源**：企业的知识产权信息表，统计专利总数（包含所有类型）。

### 3.4 数据导出 (Export)

- 点击"Excel 下载"按钮，将当前筛选条件下的所有记录导出。
- 导出的文件名为：`강원기업통계리포트_YYYYMMDD.xlsx`。
- 导出内容应包含所有展示列，并在首行添加筛选条件摘要。

## 4. 验收标准 (Acceptance Criteria)

### 4.1 筛选逻辑

#### 4.1.1 基础筛选

- [ ] 选择"年度"后，季度和月度应自动重置或进行二级联动。
- [ ] 必须支持主导产业 KSIC 编码的多选功能，且映射关系需与 `docs/01-requirements/customer-inputs/active` 中的 Page 3 列表完全一致。
- [ ] 关键词搜索应同时匹配企业名称和事业者编号。

#### 4.1.2 政策关联筛选

- [ ] 创业中心大学、全球事业、RISE事业团支持**多选**（可以同时选择多个）。
- [ ] 数据来源：`企业信息 > 事业信息 > 参与项目信息` 中记录的项目列表。
- [ ] 筛选逻辑：只要企业参与过任意一个被选中的项目，即符合条件（OR 逻辑）。
- [ ] 如果未选择任何政策项目，则不应用此筛选条件（查询所有企业）。

#### 4.1.3 投资情况筛选

- [ ] **投资引进与否**：支持"是"、"否"、"全部"三种状态。
- [ ] **投资引进额筛选**：
  - 提供预设区间：1000万以上、5000万以上、1亿以上。
  - 支持自定义区间输入（最小值 - 最大值）。
  - 金额单位统一为**万元**（韩元自动换算）。
  - 如果选择"投资引进与否 = 否"，则投资金额筛选自动禁用。

#### 4.1.4 知识产权筛选

- [ ] **专利数量筛选**：
  - 提供预设区间：1个以上、3个以上、5个以上、10个以上。
  - 支持自定义区间输入（最小值 - 最大值）。
  - 专利数量统计包含所有类型的专利（发明、实用新型、外观设计等）。

#### 4.1.5 异常处理

- [ ] **异常参数处理**：如果输入的年度、月份或主导产业代码非法（不在系统定义范围内），API 必须返回 `400 Bad Request` 并按照项目标准返回 `ValidationError` 错误结构。
- [ ] **金额/数量范围验证**：
  - 最小值不能大于最大值。
  - 金额和数量必须为非负数。
  - 输入非法字符时显示错误提示。

### 4.2 UI/UX 规范

#### 4.2.1 整体布局

- [ ] 遵循 **`dev-ui_ux_design`** 规范：采用极致紧凑的单卡片大布局。
- [ ] 参考 **`통계리포트_PPT_4페이지`** 的核心字段配置。
- [ ] 分类导航：内部使用 **Capsule Badge (胶囊标签)** 定义逻辑分区，移除繁琐图标。
- [ ] 交互增强：所有筛选行支持 `hover:bg-gray-50` 的视觉反馈。

#### 4.2.2 筛选控件设计

- [ ] **量化指标**：营收、员工、投资、专利全面支持 **Min ~ Max 双区间** 填写。
  - 支持“XX以上”查询（仅填左侧 Min）。
  - 支持“XX以下”查询（仅填右侧 Max）。
- [ ] **搜索按钮**：固定在卡片底部右侧或统一在页头 ReportHeader 触发执行。

#### 4.2.3 结果展示

- [ ] 列表支持分页加载，每页默认 10 条，支持切换为 20/50/100 条。
- [ ] 表格列支持排序（按投资额、专利数、营收等）。
- [ ] "参与项目"列如有多个项目，使用逗号分隔或标签展示。
- [ ] 投资金额和营收使用千分位分隔符格式化显示。

### 4.3 国际化 (i18n)

- [ ] 所有字段标签、筛选选项、提示信息必须在 `frontend/src/admin/modules/statistics/locales/` 中定义。
- [ ] 关键 Key 结构参考：
  - `statistics.filter.gangwonIndustry`: "主导产业"
  - `statistics.filter.policyTags`: "政策关联"
  - `statistics.table.enterpriseName`: "企业名称"
  - `statistics.export.pastingMaskHint`: "包含脱敏数据"
- [ ] 支持中文 (zh-CN) 和韩语 (ko-KR)。

### 4.4 美学校验 (Aesthetic Verification)

- [ ] **色彩方案**：主色调使用 `#1e40af` (Admin Blue)，按钮 hover 状态有平滑过渡。
- [ ] **卡片布局**：筛选区域使用 `bg-white` + `shadow-sm` + `border-gray-200`，细边框（1px）。
- [ ] **间距一致性**：各筛选控件间距统一为 `gap-4`，内外边距遵循系统级 4px 倍数规范。
- [ ] **响应式**：在 1440px 分辨率下，筛选框应排列为 2-3 行，不产生水平滚动。
- [ ] **加载反馈**：查询时表格应显示 Skeleton Screen 或全局 Loading 遮罩。

## 5. API 接口规范

### 5.1 统计查询接口

**端点**: `GET /api/admin/statistics/report`

**请求参数**:

```typescript
interface StatisticsQueryParams {
  // 时间筛选
  year?: number;
  quarter?: number;
  month?: number;

  // 产业筛选
  majorIndustryCodes?: string[]; // KSIC 字母代号 [A-U]
  gangwonIndustryCodes?: ("natural_bio" | "ceramic" | "digital_health")[];

  // 政策关联筛选
  policyTags?: ("STARTUP_UNIVERSITY" | "GLOBAL_GLOCAL" | "RISE")[];

  // 投资筛选
  hasInvestment?: boolean;
  minInvestment?: number; // 最小投资额（韩元）
  maxInvestment?: number; // 最大投资额（韩元）

  // 专利筛选
  minPatents?: number;
  maxPatents?: number;

  // 代表者特征
  gender?: "MALE" | "FEMALE";
  minAge?: number;
  maxAge?: number;

  // 搜索与分页
  searchQuery?: string; // 匹配 enterpriseName 或 bizRegNo
  page?: number;
  pageSize?: number;
  sortBy?:
    | "enterprise_name"
    | "total_investment"
    | "patent_count"
    | "annual_revenue";
  sortOrder?: "asc" | "desc";
}
```

**响应结构**:

```json
{
  "success": true,
  "data": {
    "items": [
      {
        "biz_reg_no": "123-45-67890",
        "enterprise_name": "강원바이오(주)",
        "industry_type": "식료품 제조업",
        "startup_stage": "GROWTH",
        "policy_tags": ["RISE", "STARTUP_UNIVERSITY"],
        "total_investment": 500000000,
        "patent_count": 5,
        "annual_revenue": 1200000000
      }
    ],
    "total": 125,
    "page": 1,
    "page_size": 10
  }
}
```

### 5.2 数据导出接口

**端点**: `GET /api/admin/statistics/export`

**说明**: 该接口采用 GET 请求，参数与查询接口完全一致，方便从前端直接发起下载。

**安全要求**:

- **PII 脱敏**：导出的 Excel 中，代表者手机号应脱敏显示（如 `010-****-1234`）。
- **事业者编号**：保持完整以便数据对齐。
- **文件溯源**：Excel 底部应包含生成该报告的管理员 ID 及导出时间戳。

## 6. 技术约束与安全性

### 6.1 权限控制

- **数据权限**：仅限 `Admin` 角色访问统计报告页面。
- **API 鉴权**：所有统计接口必须验证用户的管理员权限。

### 6.2 数据安全

- **脱敏处理**：导出 Excel 时，如果涉及个人隐私数据（如法人手机号），需按安全规范进行部分脱敏。
- **敏感数据**：投资金额、营收等财务数据仅向有权限的管理员展示。

### 6.3 性能要求

- **查询响应时间**：筛选查询应在 2 秒内返回结果（万级数据）。
- **导出限制**：单次导出最多支持 10,000 条记录，超过则提示分批导出。
- **数据库索引**：必须为常用筛选字段（参与项目、投资状态、专利数）创建索引。

## 7. 数据模型参考

### 7.1 涉及的数据表

1. **企业基础信息表** (`companies`)
   - 企业名称、事业者编号、行业分类、创业阶段等

2. **事业参与信息表** (`company_programs`)
   - 企业ID、项目类型（创业中心/全球/RISE）、参与时间

3. **投资信息表** (`company_investments`)
   - 企业ID、投资轮次、投资金额、投资时间

4. **知识产权信息表** (`company_patents`)
   - 企业ID、专利类型、专利编号、申请/授权时间

5. **财务信息表** (`company_finances`)
   - 企业ID、年度、营收、出口额

### 7.2 关键字段映射

参见 **3.2 数据展示列表** 中的字段映射表。

## 8. 开发顺序建议

1. **Phase 1**: 基础筛选功能（时间、行业、关键词）
2. **Phase 2**: 政策关联筛选（参与项目查询）
3. **Phase 3**: 投资和专利筛选
4. **Phase 4**: 结果展示和分页
5. **Phase 5**: 数据导出功能
6. **Phase 6**: 性能优化和测试

---

_本 PRD 根据 dev-prd skill 规范生成。_
_参考界面设计：통계리포트\_PPT_4페이지.pptx_
