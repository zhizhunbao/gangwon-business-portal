# 2025-11-29 Check_v1

## 1. Frontend 로그인/메뉴 동작

- [ ] **초기 진입 시 로그인 상태 표시 수정**

  - 실제로 로그인되지 않은 상태에서는 사용자에게 "로그인된 것처럼" 보이지 않도록 헤더/메뉴/프로필 UI를 비로그인 상태 전용으로 표시한다.
  - 로그인 필요 메뉴(예: 프로젝트) 클릭 시, 로그인 페이지 또는 로그인 팝업으로 이동/표시되도록 통일한다.
- [ ] **로그인 필요한 페이지 진입 시 동작 통일**

  - 인증이 필요한 모든 페이지(프로젝트 등)는 비로그인 상태에서 접근 시 로그인 레이어 팝업형태로로 적용한다.
- [ ] **관리자 로그인 페이지 UI 수정**

  - 관리자 로그인 페이지(`/admin/login`)에서는 회원가입 링크나 버튼을 제거한다.
  - 관리자 계정은 시스템 관리자에 의해 직접 생성되므로, 일반 사용자 회원가입 기능은 제공하지 않는다.
  - 관리자 로그인 페이지에는 "관리자 계정이 필요하신가요? 시스템 관리자에게 문의하세요." 형태의 안내 문구를 표시한다.

---

## 2. 회원가입 – 사업자번호 / 이메일 / 비밀번호 검증

- [ ] **사업자등록번호 중복 실시간 체크**

  - 사업자번호 입력 후(또는 debounce 후) 백엔드로 중복 여부를 조회하고, 결과에 따라 입력 필드 근처에 실시간 메시지를 노출한다.
    - 예: `사용 가능`, `이미 등록된 사업자번호입니다` 등 텍스트는 별도 i18n/상수로 관리.
  - “다음 단계로 진행” 버튼은 유효한 사업자번호 + 중복 아님 상태에서만 활성화되도록 한다.
- [ ] **이메일 중복 실시간 체크**

  - 이메일 입력 시 백엔드로 중복 여부를 조회하고, 결과에 따라 실시간 메시지를 노출한다.
    - 예: `사용 가능한 이메일`, `이미 사용 중인 이메일입니다` 등의 형태.
  - 이메일 형식 검증(프론트) + 중복 검증(백엔드)을 모두 통과한 경우에만 다음 단계로 진행할 수 있도록 한다.
- [ ] **비밀번호 유효성 / 일치 여부 실시간 표시**

  - 비밀번호 입력 시, 우측(또는 필드 하단)에 다음 조건을 실시간으로 표시한다.
    - 비밀번호 정책 충족 여부(길이, 조합 등).
    - 비밀번호/비밀번호 확인 필드가 서로 일치하는지 여부.
  - 두 필드가 유효하고 일치해야만 가입 버튼이 활성화되도록 한다.

---

## 3. 회원가입 – 주소/날짜/파일 업로드 UI

- [ ] **주소 검색 후 팝업 자동 닫힘**

  - 주소 검색 팝업에서 주소를 선택하면, 메인 폼의 주소 필드에 값이 정상적으로 채워진 뒤(정상작동), 주소 검색 팝업이 자동으로 닫히도록 동작을 수정한다.
- [ ] **법인 설립일 입력 동작 통일**

  - 날짜 아이콘을 클릭했을 때 열리는 달력 UI가, 입력 박스 자체를 클릭했을 때도 동일하게 열리도록 이벤트를 연결한다.
  - 직접 타이핑 및 달력 선택 모두 허용하되, 유효하지 않은 수동 입력은 검증 에러를 표시한다.
- [ ] **날짜 포맷 통일 (YYYY-MM-DD)**

  - 법인 설립일 등 모든 날짜 표시 형식을 `YYYY-MM-DD`로 통일한다.
    - 예: `2025-11-22` 형식.
  - 화면 표시, 입력 placeholder, 백엔드로 전송되는 값이 모두 동일한 포맷을 사용하도록 포맷터를 적용한다.
- [ ] **파일 업로드 – 삭제 시 텍스트도 초기화**

  - 파일 선택 후 “Remove file” 버튼을 클릭하면, 내부 파일 상태뿐 아니라 표시 중인 파일명 텍스트도 즉시 제거한다.
  - 동일한 이름의 파일을 다시 선택해도 업로드 이벤트가 정상적으로 동작하도록, `<input type="file">` 값을 초기화하거나 파일 변경 감지 로직을 재검토한다.

---

## 4. 회원가입 – 전화번호 / 이메일 포맷

- [ ] **전화번호 자동 포맷 제거**
  - 현재 전화번호 입력 시 자동으로 포맷팅되는 기능을 제거한다.
  - 숫자/특수문자 허용 규칙 정도만 두고, 포맷은 사용자가 자유롭게 입력하도록 한다.
  - 필요 시, “예시 포맷” 정도만 placeholder 또는 도움말로 안내한다.

---

## 5. 로그인 승인 상태 처리

- [ ] **미승인 계정 로그인 시 경고 메시지 노출**

  - 관리자 승인이 나지 않은 계정으로 로그인 시도(사업자번호 + 비밀번호 입력 후 로그인 버튼 클릭)할 경우, 아무 반응이 없지 않도록 명확한 경고 메시지를 노출한다.
    - 예: `관리자 승인 후에 서비스를 이용하실 수 있습니다.` 형태의 토스트/다이얼로그.
  - 백엔드 응답 코드/메시지에 따라 승인 대기 상태를 구분하고, 그에 맞는 UI 메시지로 매핑한다.
- [ ] **회원가입 완료 후 이동 경로 수정**

  - 회원가입이 완료되면, “로그인 페이지” 대신 메인 페이지로 리다이렉트한다.
  - 로그인 페이지에서 로그인 버튼 클릭 시, 관리자 승인이 안된 회원의 경우 모달로 “관리자 승인 후 로그인 가능” 안내 문구를 표시한다.
  - 향후 정책 변경 시를 고려해, 회원가입 완료 후 이동 경로와 메시지는 설정/상수로 관리한다.

---

## 6. 로그인 필요 페이지 공통 처리

- [ ] **로그인 필요 메뉴 클릭 시 팝업/리다이렉트 공통 로직**
  - 프로젝트 등 로그인 필수 메뉴를 클릭했을 때, 로그인되지 않았다면 공통 로그인 가드에서 로그인 레이어 팝업 형태로 로직을 적용한다.
  - 이 가드는 라우터 레벨(프론트) 또는 서버 응답(401/403) 처리 레벨에 공통으로 적용해, 모든 보호된 페이지에서 동일하게 동작하도록 한다.

---

## 7. 관리자 회원가입 기능

### 7.1 Frontend – 관리자 회원가입 페이지 구성

- [ ] **관리자 회원가입 페이지 별도 구성**

  - 관리자 로그인 페이지(`/admin/login`) 하단에 관리자 회원가입 링크/버튼을 추가한다.
  - 관리자 회원가입 페이지(`/admin/register`)를 기업용 회원가입(`/register`)과 별도로 구현한다.
  - 관리자 회원가입 폼에는 다음 입력 항목을 포함한다:
    - 이메일 형태의 아이디 (필수)
    - 비밀번호 (필수)
    - 비밀번호 확인 (필수)
    - 이름 (필수)
    - 전화번호 (필수)
    - 등록일 (자동 입력 또는 선택)
- [ ] **이메일 중복 실시간 체크 (Frontend)**

  - 이메일 입력 시 debounce 후 백엔드로 중복 여부를 조회한다.
  - 이메일 필드 근처에 실시간 상태 메시지를 표시한다.
    - 예: `사용 가능한 이메일`, `이미 사용 중인 이메일입니다` 등의 형태.
  - 텍스트는 i18n/상수로 관리한다.
  - 유효한 이메일 형식 + 중복 아님 상태에서만 다음 단계로 진행할 수 있도록 한다.
- [ ] **비밀번호 정책 실시간 검증 (Frontend)**

  - 비밀번호 입력 시, 비밀번호 필드 근처에 다음 조건을 실시간으로 표시한다:
    - 8자 이상
    - 대소문자 포함
    - 숫자 포함
    - 특수문자 포함
  - 각 조건 충족 여부를 체크리스트 형태로 표시한다.
- [ ] **비밀번호 확인 일치 검증 (Frontend)**

  - 비밀번호 확인 필드 입력 시, 비밀번호와 일치 여부를 실시간으로 확인한다.
  - 비밀번호 확인 필드 근처에 상태 메시지를 표시한다.
    - 예: `비밀번호가 일치합니다`, `비밀번호가 일치하지 않습니다` 등의 형태.
  - 비밀번호 정책 충족 + 비밀번호 확인 일치 상태에서만 가입 버튼이 활성화되도록 한다.

### 7.2 Backend – 관리자 회원가입 API

- [ ] **관리자 회원가입 API 구현**

  - `POST /api/admin/auth/register` 엔드포인트를 구현한다.
  - 요청 데이터: 이메일(아이디), 비밀번호, 이름, 전화번호, 등록일
  - 회원가입 시 계정 상태를 `pending` 또는 `pending_approval`로 설정한다.
  - 역할(`role`)은 `admin`으로 설정하되, 슈퍼관리자 승인 전까지는 로그인이 불가능하도록 한다.
- [ ] **이메일 중복 체크 API (관리자용)**

  - `GET /api/admin/auth/check-email/:email` 또는 `POST /api/admin/auth/check-email` 엔드포인트를 구현한다.
  - 관리자 계정과 일반 회원 계정 모두에서 이메일 중복을 검사한다.
  - 이메일 형식 검증(정규식)과 데이터베이스 중복 검사를 모두 수행한다.
  - `{ available: boolean, message: string }` 형태로 응답한다.
  - 인증이 필요 없는 public 엔드포인트로 구현한다.
- [ ] **비밀번호 정책 검증 (Backend)**

  - 비밀번호 정책을 상수로 정의한다:
    - 최소 8자 이상
    - 대소문자 포함
    - 숫자 포함
    - 특수문자 포함
  - 회원가입 시 비밀번호 정책을 검증하고, 위반 시 명확한 에러 메시지를 반환한다.
  - 비밀번호 정책은 설정 파일 또는 환경 변수로 관리하여 향후 변경이 용이하도록 한다.
- [ ] **슈퍼관리자 승인 프로세스**

  - 관리자 회원가입 완료 후 계정 상태를 `pending_approval`로 설정한다.
  - 슈퍼관리자 승인 API(`POST /api/admin/users/:id/approve`)를 구현한다.
  - 승인 후 계정 상태를 `active`로 변경하고, 승인된 관리자는 로그인이 가능하도록 한다.
  - 계정 상태 변경 이력은 감사 로그(`audit_logs`)에 기록한다.
  - 미승인 관리자 계정으로 로그인 시도 시 `403 Forbidden` 응답과 함께 "슈퍼관리자 승인 후 로그인이 가능합니다" 메시지를 반환한다.

---

## 8. Backend – 데이터 검증 및 에러 처리

- [ ] **입력 데이터 검증 강화**

  - Pydantic 스키마를 사용하여 모든 API 요청 데이터를 검증한다.
  - 사업자번호, 이메일은 정규식을 사용하여 형식 검증을 수행한다.
  - 검증 실패 시 명확한 필드별 에러 메시지를 반환한다.
- [ ] **에러 응답 형식 통일**

  - 모든 API 에러 응답은 통일된 형식으로 반환한다.
    - 예: `{ "code": "ERROR_CODE", "message": "사용자 친화적 메시지", "details": {} }`
  - HTTP 상태 코드와 에러 코드를 적절히 매핑한다.
  - 프론트엔드에서 에러를 쉽게 처리할 수 있도록 에러 코드 상수를 정의한다.

---

## 9. Backend – 날짜 및 파일 처리

- [ ] **날짜 포맷 통일 및 검증**

  - 모든 날짜 입력은 `YYYY-MM-DD` 형식으로 받아들이고, 백엔드에서도 동일한 형식으로 저장/반환한다.
  - 날짜 형식 검증은 Pydantic의 `date` 타입을 사용하거나 커스텀 검증기를 구현한다.
  - 유효하지 않은 날짜(예: 2025-13-45) 입력 시 명확한 에러 메시지를 반환한다.
- [ ] **파일 업로드 검증 및 처리**

  - 파일 업로드 시 파일 크기, 확장자, MIME 타입을 검증한다.
  - 검증 규칙은 설정 파일로 관리하여 변경이 용이하도록 한다.
  - 파일 업로드 실패 시 명확한 에러 메시지를 반환한다.
  - 파일 삭제 API(`DELETE /api/upload/:fileId`)를 구현하여 프론트엔드에서 파일 삭제 요청을 처리한다.
- [ ] **파일 업로드 용량 제한 환경설정 (Frontend & Backend)**

  - Frontend와 Backend 모두에서 파일 업로드 필드의 용량 제한을 환경설정 파일에서 설정할 수 있도록 구현한다.
  - 이미지 파일과 문서 파일의 최대 용량을 별도로 설정할 수 있도록 한다.
    - 예: 이미지 파일 최대 용량 (예: 5MB), 문서 파일 최대 용량 (예: 10MB)
  - Frontend: 환경 변수(`.env.local`) 또는 설정 파일에서 용량 제한 값을 읽어와 파일 선택 시 검증한다.
    - 예: `VITE_MAX_IMAGE_SIZE=5242880` (5MB), `VITE_MAX_DOCUMENT_SIZE=10485760` (10MB)
  - Backend: 환경 변수(`.env`) 또는 설정 파일에서 용량 제한 값을 읽어와 파일 업로드 API에서 검증한다.
    - 예: `MAX_IMAGE_SIZE=5242880`, `MAX_DOCUMENT_SIZE=10485760`
  - 파일 타입별(이미지/문서) 용량 제한을 구분하여 적용하고, 초과 시 명확한 에러 메시지를 표시한다.
  - 용량 제한 값은 바이트 단위로 설정하고, 사용자에게는 MB 단위로 표시한다.
- [ ] **파일 업로드 확장자 제한 환경설정 (Frontend & Backend)**

  - Frontend와 Backend 모두에서 파일 업로드 필드의 허용 확장자를 환경설정 파일에서 설정할 수 있도록 구현한다.
  - 이미지 파일과 문서 파일의 허용 확장자를 별도로 관리한다.
    - 이미지 파일: `jpg`, `jpeg`, `png`, `gif`, `webp` 등
    - 문서 파일: `pdf`, `doc`, `docx`, `xls`, `xlsx`, `ppt`, `pptx` 등
  - Frontend: 환경 변수(`.env.local`) 또는 설정 파일에서 허용 확장자 목록을 읽어와 파일 선택 시 검증한다.
    - 예: `VITE_ALLOWED_IMAGE_EXTENSIONS=jpg,jpeg,png,gif,webp`, `VITE_ALLOWED_DOCUMENT_EXTENSIONS=pdf,doc,docx,xls,xlsx`
  - Backend: 환경 변수(`.env`) 또는 설정 파일에서 허용 확장자 목록을 읽어와 파일 업로드 API에서 검증한다.
    - 예: `ALLOWED_IMAGE_EXTENSIONS=jpg,jpeg,png,gif,webp`, `ALLOWED_DOCUMENT_EXTENSIONS=pdf,doc,docx,xls,xlsx`
  - 이미지나 문서 파일에 적합하지 않은 확장자는 업로드를 차단하고, 명확한 에러 메시지를 표시한다.
    - 예: "허용되지 않은 파일 형식입니다. 이미지 파일은 jpg, png, gif만 업로드 가능합니다."
  - 확장자 검증은 대소문자를 구분하지 않도록 구현한다 (예: `.JPG`, `.jpg` 모두 허용).
  - MIME 타입 검증도 함께 수행하여 확장자 변조를 방지한다.

---

## 10. 구현/PR 안내 (Cursor용 메타)

- [ ] **역할/목표**

  - 이 파일은 `Check_v1.pptx`에서 나온 UI/UX 수정 요구사항을 `NEXT_STEPS.md` 스타일의 구체적인 개발 태스크로 변환한 문서다.
  - 각 체크박스는 개별 PR 단위로 처리 가능하도록 설계되어 있으며, FE/BE 협업 지점을 명확히 하기 위한 것이다.
- [ ] **개발 방법 가이드**

  - 가능하면 기존 `NEXT_STEPS.md`에서 사용한 구조(섹션 번호, P0/P1, 예상 소요 등)와 통합할 수 있도록, 이 문서의 섹션을 상위 계획에 매핑한다.
  - Cursor 내에서 작업 시,
    - "어떤 화면/컴포넌트/라우트"를 수정하는지,
    - "검증/상태/메시지"를 어떻게 관리할지
      를 각 체크 항목별로 명시한 후 커밋한다.
  - Backend 작업 시,
    - "어떤 API 엔드포인트"를 구현/수정하는지,
    - "데이터베이스 스키마/인덱스" 변경이 필요한지,
    - "에러 처리 및 응답 형식"을 어떻게 통일할지
      를 각 체크 항목별로 명시한 후 커밋한다.
